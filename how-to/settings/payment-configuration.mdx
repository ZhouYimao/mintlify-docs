---
title: "Payment Configuration"
description: "Manage billing, API keys, and cost allocation for AI agent usage in Cagen"
sidebarTitle: "Payment & Billing"
---

<Info>
  Cagen's payment system uses Stripe for secure billing and provides flexible API key management to control AI agent costs across your organization.
</Info>

## Payment Overview

Cagen operates on a **usage-based billing model** where you pay for:

- **AI Agent Interactions** - Conversations, code generation, analysis
- **Memory Bank Processing** - Document indexing and retrieval  
- **Workflow Automation** - Automated task execution
- **Advanced Features** - Based on your subscription tier

## Stripe Integration

### Setting Up Payment Method

<Steps>
  <Step title="Navigate to Payment Settings">
    Go to **Avatar** → **Settings** → **Billing & Payment**
    
    Or use Command Launcher: `⌘K → "payment settings"`
  </Step>
  
  <Step title="Add Payment Method">
    Click **Add Payment Method** → **Credit/Debit Card**
    
    Cagen uses Stripe for secure payment processing
  </Step>
  
  <Step title="Enter Card Details">
    ```
    Card Number: 4242 4242 4242 4242 (example)
    Expiry: MM/YY
    CVC: 123
    Billing Address: [Your address]
    ```
    
    All payment data is encrypted and processed by Stripe
  </Step>
  
  <Step title="Verify & Confirm">
    Review payment method and billing address
    
    Click **Save Payment Method** to complete setup
  </Step>
</Steps>

### Managing Payment Methods

<CardGroup cols={2}>
  <Card title="Multiple Cards" icon="credit-card">
    Add multiple payment methods for redundancy
    
    Set primary card for automatic billing
  </Card>
  
  <Card title="Auto-Renewal" icon="refresh">
    Subscriptions auto-renew using primary payment method
    
    Update before expiration to avoid service interruption
  </Card>
  
  <Card title="Billing Alerts" icon="bell">
    Get notified when payment fails or card expires
    
    Configure alerts in notification settings
  </Card>
  
  <Card title="Usage Tracking" icon="chart-line">
    Real-time tracking of API costs and usage
    
    Set budget limits and alerts
  </Card>
</CardGroup>

## API Key Management

### API Key Priority System

Cagen uses a **priority order system** for API key usage to optimize costs and ensure availability:

<Steps>
  <Step title="1️⃣ Personal Keys (Highest Priority)">
    **Your individual API keys** - used first for your requests
    
    ```yaml
    Usage: Personal AI interactions, testing, development
    Cost: Charged to your personal account/budget
    Control: Full control over key limits and models
    ```
  </Step>
  
  <Step title="2️⃣ Team Shared Keys">
    **Shared team/project keys** - used for collaborative work
    
    ```yaml
    Usage: Team conversations, shared agents, collaborative tasks
    Cost: Shared across team members or project budget
    Control: Managed by team leads or project managers
    ```
  </Step>
  
  <Step title="3️⃣ Organization Keys">
    **Organization-wide keys** - fallback for enterprise features
    
    ```yaml
    Usage: Organization-wide agents, bulk operations
    Cost: Charged to organization account
    Control: Managed by organization administrators
    ```
  </Step>
  
  <Step title="4️⃣ Backup Keys (Lowest Priority)">
    **Emergency fallback keys** - prevent service interruption
    
    ```yaml
    Usage: When primary keys hit limits or fail
    Cost: Premium rates, used sparingly
    Control: Auto-managed by Cagen system
    ```
  </Step>
</Steps>

### Configuring API Keys

<Tabs>
  <Tab title="Personal API Keys">
    **Add Your Keys:**
    1. Go to **Settings** → **API Keys** → **Personal**
    2. Click **Add Key** → Select provider (OpenAI, Anthropic, etc.)
    3. Enter key and set spending limits
    4. Configure usage preferences
    
    **Example Configuration:**
    ```yaml
    OpenAI GPT-4:
      Key: sk-abc123...
      Monthly Limit: $100
      Priority: High
      
    Anthropic Claude:
      Key: sk-xyz789...
      Monthly Limit: $50
      Priority: Medium
    ```
  </Tab>
  
  <Tab title="Team Shared Keys">
    **Team Settings** (requires admin access):
    1. Go to **Team** → **Settings** → **API Keys**
    2. Add shared keys for team usage
    3. Set per-member limits and quotas
    4. Configure cost allocation rules
    
    **Cost Distribution:**
    ```yaml
    Frontend Team:
      Total Budget: $500/month
      Per Member: $100/month
      Overage: Use organization keys
      
    Backend Team:
      Total Budget: $800/month  
      Per Member: $160/month
      Overage: Alert team lead
    ```
  </Tab>
  
  <Tab title="Organization Keys">
    **Enterprise Settings** (admin only):
    1. **Organization** → **Settings** → **API Keys**
    2. Configure organization-wide keys
    3. Set global spending limits
    4. Configure billing alerts and controls
    
    **Enterprise Controls:**
    ```yaml
    Global Limits:
      Monthly: $5,000
      Daily: $200
      Per-User: $150
      
    Alert Thresholds:
      80% usage: Notify admins
      95% usage: Alert all users
      100% usage: Restrict non-essential usage
    ```
  </Tab>
</Tabs>

## Cost Allocation & Tracking

### Usage Attribution

<AccordionGroup>
  <Accordion title="Per-User Tracking">
    **Individual Usage:**
    - Track each user's AI interactions
    - Personal vs. shared usage breakdown
    - Historical usage patterns and trends
    
    **Billing Allocation:**
    ```yaml
    Alice Johnson (Frontend):
      Personal API Usage: $45/month
      Team Shared Usage: $23/month
      Total Attribution: $68/month
    ```
  </Accordion>
  
  <Accordion title="Per-Project Tracking">
    **Project Attribution:**
    - Track costs by project or issue
    - Agent usage for specific work items
    - Cost-per-feature analysis
    
    **Project Budgeting:**
    ```yaml
    Project Alpha:
      AI Development: $234
      Code Review: $67  
      Documentation: $45
      Total: $346
    ```
  </Accordion>
  
  <Accordion title="Per-Agent Tracking">
    **Agent Cost Analysis:**
    - Which agents are most expensive
    - Model usage optimization opportunities
    - ROI analysis for different agent types
    
    **Agent Efficiency:**
    ```yaml
    @dev-agent:
      Tasks Completed: 45
      Total Cost: $123
      Cost per Task: $2.73
      
    @research-agent:
      Tasks Completed: 23
      Total Cost: $87
      Cost per Task: $3.78
    ```
  </Accordion>
</AccordionGroup>

### Budget Management

<CardGroup cols={2}>
  <Card title="Budget Limits" icon="target">
    Set spending limits at user, team, and organization levels
    
    Automatic warnings and restrictions when limits approached
  </Card>
  
  <Card title="Usage Analytics" icon="chart-bar">
    Real-time dashboards showing usage patterns and trends
    
    Identify optimization opportunities
  </Card>
  
  <Card title="Smart Allocation" icon="zap">
    AI-powered recommendations for optimal key usage
    
    Automatic load balancing across keys
  </Card>
  
  <Card title="Forecasting" icon="trending-up">
    Predict monthly costs based on usage patterns
    
    Plan budgets and prevent overspend
  </Card>
</CardGroup>

## Billing & Invoicing

### Subscription Tiers

<Tabs>
  <Tab title="Starter Plan">
    ```yaml
    Price: $29/user/month
    Included Usage: 
      - $50 AI credits
      - Basic agents
      - Standard memory bank
    
    Additional Usage:
      - AI credits: $0.50 per $1 overage
      - Premium agents: +$10/month
    ```
  </Tab>
  
  <Tab title="Professional Plan">
    ```yaml
    Price: $79/user/month
    Included Usage:
      - $150 AI credits  
      - All agent types
      - Advanced memory bank
      - Priority support
      
    Additional Usage:
      - AI credits: $0.40 per $1 overage
      - Custom integrations: Available
    ```
  </Tab>
  
  <Tab title="Enterprise Plan">
    ```yaml
    Price: Custom pricing
    Included Usage:
      - Unlimited AI credits*
      - Custom agents
      - Enterprise memory bank
      - Dedicated support
      - SLA guarantees
      
    *Fair use policy applies
    ```
  </Tab>
</Tabs>

### Invoice Management

<Steps>
  <Step title="Monthly Billing Cycle">
    Invoices generated on your billing date each month
    
    Includes subscription fees plus usage overages
  </Step>
  
  <Step title="Detailed Usage Reports">
    Line-item breakdown of all AI usage and costs
    
    Downloadable CSV for accounting/expense tracking
  </Step>
  
  <Step title="Automatic Payment">
    Charges processed automatically using primary payment method
    
    Email notifications for successful payments
  </Step>
  
  <Step title="Failed Payment Handling">
    **Grace Period:** 3 days to update payment method
    **Service Restriction:** Limited usage during grace period
    **Account Suspension:** After grace period expires
  </Step>
</Steps>

## Cost Optimization

### Best Practices

<CardGroup cols={2}>
  <Card title="Choose Right Models" icon="settings">
    Use less expensive models for simpler tasks
    
    Reserve premium models for complex work
  </Card>
  
  <Card title="Efficient Prompts" icon="zap">
    Write clear, concise prompts to reduce token usage
    
    Use system prompts and context effectively
  </Card>
  
  <Card title="Batch Operations" icon="box">
    Group similar requests to reduce API calls
    
    Use bulk operations where available
  </Card>
  
  <Card title="Cache Results" icon="database">
    Reuse previous results where appropriate
    
    Leverage memory bank to avoid redundant queries
  </Card>
</CardGroup>

### Monitoring & Alerts

```yaml
Real-time Alerts:
  - Daily spending over $X
  - API key approaching limit
  - Failed payment notifications
  
Weekly Reports:
  - Usage summary by user/project
  - Top spending categories
  - Optimization recommendations
  
Monthly Analysis:
  - Cost trends and patterns
  - ROI analysis for AI usage
  - Budget planning suggestions
```

## Security & Compliance

### Payment Security

<AccordionGroup>
  <Accordion title="Stripe Security">
    - **PCI DSS Compliance** - Stripe handles all payment data
    - **Encryption** - All payment info encrypted in transit and at rest
    - **Fraud Protection** - Advanced fraud detection and prevention
    - **3D Secure** - Additional authentication for high-risk transactions
  </Accordion>
  
  <Accordion title="API Key Security">
    - **Encrypted Storage** - Keys stored with AES-256 encryption
    - **Access Controls** - Role-based access to key management
    - **Audit Logs** - Complete history of key usage and changes
    - **Automatic Rotation** - Optional key rotation policies
  </Accordion>
</AccordionGroup>

### Data Privacy

```yaml
Financial Data:
  - Stored with Stripe (PCI compliant)
  - Not accessible by Cagen staff
  - Regular security audits

Usage Data:
  - Encrypted and anonymized
  - Used only for billing and optimization
  - No AI model training on your data
```

## Troubleshooting

<AccordionGroup>
  <Accordion title="Payment Failed">
    **Common Causes:**
    - Insufficient funds or credit limit
    - Expired or invalid card details
    - Bank declining the transaction
    
    **Solutions:**
    - Update payment method
    - Contact your bank
    - Try alternative payment method
  </Accordion>
  
  <Accordion title="API Key Issues">
    **Symptoms:**
    - Agents not responding
    - "API limit exceeded" errors
    - Unexpected costs
    
    **Solutions:**
    - Check key limits and quotas
    - Verify key configuration
    - Review usage attribution settings
  </Accordion>
  
  <Accordion title="Billing Discrepancies">
    **If you notice unexpected charges:**
    1. Review detailed usage reports
    2. Check cost allocation settings
    3. Contact support with specific questions
    
    **Common Issues:**
    - Shared usage attribution
    - Test/development usage inclusion
    - Agent background processing
  </Accordion>
</AccordionGroup>

## Related Features

- [Issue Management](/how-to/work/issue-management) - Track AI costs per work item
- [Agent Management](/how-to/agents/create-custom-agent) - Configure agent cost optimization
- [Memory Bank](/how-to/memory/manage-memory-bank) - Optimize document processing costs
- [Team Management](/reference/team-settings) - Configure shared billing and quotas

<Note>
  Cagen's payment system is designed to be transparent and predictable. The API key priority system ensures you have control over costs while maintaining service availability, and detailed usage tracking helps you optimize your AI spending.
</Note>